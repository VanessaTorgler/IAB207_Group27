{% extends "base.html" %}
{% block title %}
<title>Bondra – Create / Update Event</title>
{% endblock %}


{% block header %}
<header class="py-4 border-bottom">
  <div class="container">
    <h1 class="h3 mb-1">Create or Update an Event</h1>
    <p class="text-muted mb-0">Add details, upload an image, and publish. Fields marked * are required.</p>
  </div>
</header>
{% endblock %}
{% block content %}

<main class="container py-4">
  <form id="eventForm" class="row g-4" method="POST" enctype="multipart/form-data">
    {{ form.csrf_token }}
    {{ form.hidden_tag() }}
    <!-- Left column -->
    <div class="col-12 col-lg-8">
      <div class="card">
        <div class="card-header fw-semibold">Event details</div>
        <div class="card-body">
          {% if form.errors %}
          <div class="mb-3">
            <div class="alert alert-danger" role="alert">
              Please correct the errors below.
              <ul class="errors">
                {% for field_name, error_list in form.errors.items() %}
                {% for error in error_list %}
                <li>{{ error }}</li>
                {% endfor %}
                {% endfor %}
              </ul>
            </div>
          </div>
          {% endif %}
          <div class="mb-3">
            <label for="title" class="form-label">Title *</label>
            <input id="title" name="title" type="text" value="{{ form.title.data }}" class="form-control" required
              placeholder="e.g., Founders’ Breakfast: AI in Practice">
          </div>

          <div class="mb-3">
            <label for="description" class="form-label">Description *</label>
            <textarea id="description" name="description" value="{{ form.description.data }}" class="form-control"
              rows="5" required placeholder="What is the event about? Who should attend?"></textarea>
          </div>

          <div class="row g-3">
            <div class="col-12 col-md-6">
              <label for="category" class="form-label">Category *</label>
              <select id="category" name="category" class="form-select" required>
                {% for value, label in form.category.choices %}
                <option value="{{ value }}" {% if form.category.data==value %}selected{% endif %}>
                  {{ label }}
                </option>
                {% endfor %}
              </select>
            </div>
            <div class="col-12 col-md-6">
              <label for="format" class="form-label">Format *</label>
              <select id="format" name="format" class="form-select" required>
                {% for value, label in form.format.choices %}
                <option value="{{ value }}" {% if form.format.data==value %}selected{% endif %}>
                  {{ label }}
                </option>
                {% endfor %}
              </select>
            </div>
          </div>

          <div class="row g-3 mt-0">
            <div class="col-12 col-md-6">
              <label for="date" class="form-label">Date *</label>
              <input id="date" type="date" name="date"
                value="{{ form.date.data.strftime('%Y-%m-%d') if form.date.data else '' }}" class="form-control"
                required>

            </div>
            <div class="col-6 col-md-3">
              <label for="start" class="form-label">Start time *</label>
              <input id="start" type="time" name="start_time"
                value="{{ form.start_time.data.strftime('%H:%M') if form.start_time.data else '' }}"
                class="form-control" required>
            </div>
            <div class="col-6 col-md-3">
              <label for="end" class="form-label">End time *</label>
              <input id="end" type="time" name="end_time"
                value="{{ form.end_time.data.strftime('%H:%M') if form.end_time.data else '' }}" class="form-control"
                required>
            </div>
            <div class="col-12 col-md-6">
              <label for="timezone" class="form-label">Time zone</label>
              <select id="timezone" name="timezone" class="form-select">
                {% for value, label in form.timezone.choices %}
                <option value="{{ value }}" {% if form.timezone.data==value %}selected{% endif %}>
                  {{ label }}
                </option>
                {% endfor %}
              </select>

            </div>

          </div>

          <div class="row g-3 mt-0">
            <div class="col-12 col-md-8">
              <label for="venue" class="form-label">Location / Venue *</label>
              <input id="venue" name="location" type="text" value="{{ form.location.data }}" class="form-control"
                required placeholder="e.g., Brisbane CBD, Level 2, 123 Adelaide St">
            </div>
            <div class="col-12 col-md-4">
              <label for="capacity" class="form-label">Capacity *</label>
              <input id="capacity" name="capacity" type="number" value="{{ form.capacity.data }}" min="1" step="1"
                class="form-control" required placeholder="e.g., 30">
            </div>
          </div>

          <div class="mt-3">
            <label for="image" class="form-label">Event image *</label>
            <input id="image" name="event_image" type="file" value="{{ form.event_image.data }}" class="form-control"
              accept="image/*" required>
            <div class="form-text">JPEG/PNG recommended. Appears on the event card and details page.</div>
          </div>
          <div class="mt-3">
            <label for="imageAlt" class="form-label">Image alt text</label>
            <input id="imageAlt" name="image_alt_text" type="text" value="{{ form.image_alt_text.data }}"
              class="form-control" placeholder="Describe the image for screen readers">
          </div>
        </div>
      </div>

      <div class="card mt-4">
        <div class="card-header fw-semibold">Tickets & Pricing</div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12 col-md-4">
              <label for="price" class="form-label">Ticket price (AUD)</label>
              <input id="price" name="ticket_price" type="number" value="{{ form.ticket_price.data }}"
                class="form-control" min="0" step="0.01" placeholder="e.g., 25.00">
              <div class="form-text">If $0, event will be listed as Free.</div>
            </div>
            <div class="col-12 col-md-4">
              <label for="rsvpClose" class="form-label">RSVP closes</label>
              <input id="rsvpClose" name="rsvp_closes" value="{{ form.rsvp_closes.data }}" type="datetime-local"
                class="form-control">
            </div>
          </div>
        </div>
      </div>


      <div class="card mt-4">
        <div class="card-header fw-semibold">Host & contact</div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12 col-md-6">
              <label for="host" class="form-label">Host/Organisation *</label>
              <input id="host" name="host_name" value="{{ form.host_name.data }}" type="text" class="form-control"
                required placeholder="e.g., Brisbane Startups Collective">
            </div>
            <div class="col-12 col-md-6">
              <label for="contact" class="form-label">Contact email *</label>
              <input id="contact" name="host_contact" value="{{ form.host_contact.data }}" type="email"
                class="form-control" required placeholder="support@foundersbreakfast.com">
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right column -->
    <aside class="col-12 col-lg-4">
      <div class="card">
        <div class="card-header fw-semibold">Publish</div>
        <div class="card-body">
          <div class="d-grid gap-2">
            <button type="submit" class="btn btn-primary" name="action" value="publish" form="eventForm">
              Publish
            </button>

            <button type="submit" class="btn btn-outline-secondary" name="action" value="draft" form="eventForm">
              Save as Draft
            </button>

            <!-- CSS-only modal trigger -->
            <a href="#scheduleModal" class="btn btn-info">Schedule</a>

            <button type="reset" class="btn btn-outline-secondary">Reset</button>
          </div>
        </div>
      </div>
    </aside>

    <!-- CSS-ONLY MODAL -->
    <div id="scheduleModal" class="modal-css" aria-labelledby="scheduleTitle" role="dialog" aria-modal="true">
      <div class="modal-css__dialog card shadow">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h2 id="scheduleTitle" class="h5 mb-0">Schedule Publish</h2>
          <!-- Close  -->
          <a href="#" class="btn-close" aria-label="Close"></a>
        </div>
        <div class="card-body">
          <!-- Inputs are bound to the main form via the `form` attribute -->
          <div class="mb-3">
            <label for="scheduleAt" class="form-label">Publish date &amp; time</label>
            <input type="datetime-local" class="form-control" id="scheduleAt" name="scheduleAt" form="eventForm"
              aria-describedby="scheduleHelp">
            <div id="scheduleHelp" class="form-text">Choose when this event should go live.</div>
          </div>

          <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" id="notifyOnPublish" name="notifyOnPublish" value="1"
              form="eventForm">
            <label class="form-check-label" for="notifyOnPublish">
              Email me a reminder when the event is published
            </label>
          </div>

          <div class="d-grid gap-2">
            <button type="submit" class="btn btn-info schedule-modal-button" name="action" value="schedule"
              form="eventForm">
              Schedule
            </button>
            <a href="#" class="btn btn-outline-secondary">Cancel</a>
          </div>
        </div>
      </div>
    </div>
  </form>
</main>
{% endblock %}